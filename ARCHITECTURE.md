# 项目架构图

## 系统架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                    微服务层 (Microservices Layer)                │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────┐    ┌─────────────────────────┐    │
│  │   认证和权限管理服务      │    │    酒店业务管理服务      │    │
│  │  ProjectOrleansServer   │    │     ProjectHotel        │    │
│  │                         │    │                         │    │
│  │  ┌─────────────────┐    │    │  ┌─────────────────┐    │    │
│  │  │  认证Grain接口   │    │    │  │  酒店Grain接口   │    │    │
│  │  │ • IAuthGrain    │    │    │  │ • IHotelGrain   │    │    │
│  │  │ • IPermission   │    │    │  │ • IReservation  │    │    │
│  │  │   Grain         │    │    │  │   Grain         │    │    │
│  │  └─────────────────┘    │    │  │ • IHotelMgmt    │    │    │
│  │                         │    │  │   Grain         │    │    │
│  │  ┌─────────────────┐    │    │  └─────────────────┘    │    │
│  │  │  认证Grain实现   │    │    │                         │    │
│  │  │ • AuthGrain     │    │    │  ┌─────────────────┐    │    │
│  │  │ • Permission    │    │    │  │  酒店Grain实现   │    │    │
│  │  │   Grain         │    │    │  │ • HotelGrain    │    │    │
│  │  └─────────────────┘    │    │  │ • Reservation   │    │    │
│  │                         │    │  │   Grain         │    │    │
│  │  ┌─────────────────┐    │    │  │ • HotelMgmt     │    │    │
│  │  │  认证数据模型    │    │    │  │   Grain         │    │    │
│  │  │ • User          │    │    │  └─────────────────┘    │    │
│  │  │ • Role          │    │    │                         │    │
│  │  │ • Permission    │    │    │  ┌─────────────────┐    │    │
│  │  └─────────────────┘    │    │  │  酒店数据模型    │    │    │
│  │                         │    │  │ • Hotel         │    │    │
│  │  ┌─────────────────┐    │    │  │ • Room          │    │    │
│  │  │ Orleans Dashboard│    │    │  │ • Reservation   │    │    │
│  │  │ Port: 10010     │    │    │  └─────────────────┘    │    │
│  │  └─────────────────┘    │    │                         │    │
│  │                         │    │  ┌─────────────────┐    │    │
│  │                         │    │  │ Orleans Dashboard│    │    │
│  │                         │    │  │ Port: 10011     │    │    │
│  │                         │    │  └─────────────────┘    │    │
│  └─────────────────────────┘    └─────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                    │
                                    │ Service Communication
                                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    数据存储层 (Data Layer)                        │
├─────────────────────────────────────────────────────────────────┤
│  DB (Database Management)                                       │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │              HotelDbContext                            │  │
│  │  - Entity Framework Core                               │  │
│  │  - SQL Server数据库                                    │  │
│  │  - 实体配置和索引                                       │  │
│  └─────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 数据流图

```
用户请求 → 认证服务 → 权限验证 → 业务服务 → 数据库操作
    ↑         │         │         │         │
    └─────────┴─────────┴─────────┴─────────┘
```

## 微服务交互图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   认证服务       │    │   业务服务       │    │   数据库        │
│                 │    │                 │    │                 │
│ • 用户认证       │───▶│ • 业务逻辑       │───▶│ • 数据存储       │
│ • 权限管理       │    │ • 数据处理       │    │ • 数据模型       │
│ • JWT令牌        │    │ • 状态管理       │    │ • 关系映射       │
│ • 角色控制       │    │ • 业务规则       │    │ • 事务管理       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 服务间通信流程

```
1. 用户登录请求
   ↓
2. 认证服务验证用户凭据
   ↓
3. 返回JWT令牌和用户信息
   ↓
4. 业务服务接收请求
   ↓
5. 业务服务调用认证服务验证权限
   ↓
6. 权限验证通过，执行业务逻辑
   ↓
7. 访问数据库进行数据操作
   ↓
8. 返回业务结果给用户
```

## 部署架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        生产环境部署                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │  负载均衡器   │  │  Orleans    │  │  Orleans    │              │
│  │             │  │   Silo 1    │  │   Silo 2    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
│         │                │                │                    │
│         └────────────────┼────────────────┘                    │
│                          │                                    │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                 SQL Server集群                         │  │
│  │  - 主数据库                                           │  │
│  │  - 备份数据库                                         │  │
│  │  - 高可用性配置                                       │  │
│  └─────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 技术栈层次

```
┌─────────────────────────────────────────────────────────────────┐
│                        应用层                                   │
│  • .NET 9.0                                                    │
│  • C# 12                                                       │
├─────────────────────────────────────────────────────────────────┤
│                        框架层                                   │
│  • Microsoft Orleans 9.2.1                                    │
│  • Entity Framework Core 9.0                                  │
│  • OrleansDashboard 8.2.0                                     │
├─────────────────────────────────────────────────────────────────┤
│                        运行时层                                 │
│  • .NET Runtime 9.0                                           │
│  • ASP.NET Core 9.0                                           │
├─────────────────────────────────────────────────────────────────┤
│                        操作系统层                               │
│  • Windows/Linux/macOS                                        │
└─────────────────────────────────────────────────────────────────┘
```

## 关键特性

### 1. 分布式架构
- 基于Actor模型的分布式系统
- 自动负载均衡和故障转移
- 水平扩展能力

### 2. 状态管理
- 内存中的Grain状态
- 持久化存储支持
- 状态一致性保证

### 3. 监控和调试
- 实时监控面板
- 性能指标收集
- 错误日志和跟踪

### 4. 数据持久化
- Entity Framework Core ORM
- SQL Server数据库
- 完整的实体关系映射

### 5. 开发体验
- 强类型接口
- 异步编程模型
- 内置调试工具
